---
title: "Analysis of FitBit User Trends"
author: "Will Massey"
date: "8/18/2021"
output: html_document
---

# Summary

We will be exploring a public dataset from Kaggle describing how users interact with their smart devices, in this case FitBit.
We hope to gain valuable insights that can be applied to Bellabeat's wearable technology to develop stronger marketing strategies for their wearable products. Bellabeat is a high-tech manufacturer of health-focused products for women who design wearable technology that track user's activities and several health related metrics. 

### Business questions at hand:
* What are some trends in smart device usage?
* How could these trends apply to Bellabeat customers?
* How could these trends help influence Bellabeat marketing strategy?

### About the data: 

* **Source**: <https://www.kaggle.com/arashnic/fitbit>
* **Description**: These datasets were generated by respondents to a distributed survey
 via Amazon Mechanical Turk between 03.12.2016-05.12.2016. Thirty eligible FitBit users 
consented to the submission of personal tracker data, including minute-level output for physical activity,
 heart rate, and sleep monitoring. Variation between output represents use of different types of FitBit trackers 
and individual tracking behaviors / preferences.
* **About the data**: The data is seperated into 18 seperate .csv files, each containing unique user IDs organized by periods of time. We will only be using a few files, as much of the data is replicated across datasets. We will be focusing on user's daily activity, heartrate, and sleep patterns.  

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

##creating a hook to enable scrolling of code output
knitr::knit_hooks$set(output = function(x, options){
  if(!is.null(options$max_height)){
    paste('<pre style = "max-height:', options$max_height, '; float: left; width: 910px; overflow-y: auto;">', x, "</pre>", sep = "")
  }else{
    x
  }
  
})

color_pallet = cbp1 <- c("#51e8c2", "#5183e8", "#b851e8", "#e851a2",
          "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
```

# Cleaning / Joining Datasets for Analysis  

### Importing Packages and Datasets  

```{r libraries, message=FALSE}

library(tidyverse)
library(lubridate)
library(tidyr)
library(dplyr)
library(ggplot2)
library(reshape2)
library(skimr)
library(ggpubr)

daily_activity = read.csv("bellabeat_data_raw/dailyActivity_merged.csv")
seconds_heartrate = read.csv("bellabeat_data_raw/heartrate_seconds_merged.csv")
daily_sleep = read.csv("bellabeat_data_raw/sleepDay_merged.csv")

```
### Formatting Dataframes  

```{r clean, results='hold', max_height = "350px"}

## inspecting data and checking for NA
str(daily_activity)
writeLines('\nNumber of N/A per column:')
colSums(is.na(daily_activity))
## formatting date from type chr to date 
daily_activity = daily_activity %>% mutate(Date = strptime(daily_activity$ActivityDate, "%m/%d/%Y"))
daily_activity$ActivityDate = NULL

## inspecting data and check for NA
str(seconds_heartrate)
writeLines('\nNumber of N/A per column:')
colSums(is.na(seconds_heartrate))
## formatting datetime from type chr to date
seconds_heartrate = seconds_heartrate %>% mutate(Date = strptime(seconds_heartrate$Time, "%m/%d/%Y"))
seconds_heartrate$Time = NULL

## getting daily average of heart rate by Id and Date
avg_heartrate = seconds_heartrate %>% group_by(Id, Date) %>% summarise_at(vars("Value"), mean) %>%
  rename(avg_heartrate = Value)
##joining average heart rate to main data by Id and Date
daily_activity = left_join(daily_activity, avg_heartrate, by = c("Id" = "Id", "Date" = "Date"))

## inspecting data and checking for NA
str(daily_sleep)
writeLines('\nNumber of N/A per column:')
colSums(is.na(daily_sleep))

daily_sleep = daily_sleep %>% mutate(Date = strptime(daily_sleep$SleepDay, "%m/%d/%Y"))
daily_sleep$SleepDay = NULL
##joining sleep data by Id and Date
daily_activity = left_join(daily_activity, daily_sleep, by = c("Id" = "Id", "Date" = "Date"))

```


Our joined dataframe for analysis:  


```{r display, max_height="350px", results='hold'}

skim(daily_activity)

```


It appears over half of our subjects' daily sleep and heart rate data are unavailable. By having incomplete data, we lose some ability to give an
accurate analysis. Also per the datasets description, users wore different devices and / or had different personal tracking preferences. In order to get an accurate analysis, we will be plotting each user on their own charts. Their ID will be displayed at the top of each chart.   

# Discovering Trends in the Data  

We will begin by plotting how many calories each user burns by how many steps they take in a given day.

```{r steps_to_calories, fig.height=10, fig.width=12, message=FALSE, warning=FALSE, max_height="720px"}

## plot relationship of steps walked and calories burned per user
ggplot(data = daily_activity) + geom_point(mapping = aes(x = TotalSteps, y = Calories)) +
  geom_smooth(mapping = aes(x = TotalSteps, y = Calories)) +
  facet_wrap(~Id) + 
  labs(title = "Steps Taken to Calories Burned by User", x = "Steps taken", y = "Calories Burned")

```

As expected, users who take more steps tend to burn more calories. Bellabeat marketing and design could incorporate reminders and incentives through 
their mobile apps to encourage more steps being taken throughout the day to help burn more calories. 
  
Next we plot the relationship between steps taken each day over a small period of time to gain insights on each user's activity.  

```{r date_to_steps, fig.height=10, fig.width=12, message=FALSE, warning=FALSE, max_height="720px"}

ggplot(data = daily_activity) + geom_line(mapping = aes(x = Date, y = TotalSteps)) + 
  facet_wrap(~Id) + 
  labs(title = "Steps Taken by Day per User", x = "Date", y = "Steps Taken") + 
  theme(axis.text.x = element_text(angle = 45))

```

It appears most users go from higher steps per day to lower steps per day, in a cycle. If the same user trends exists for Bellabeat smart device users,
then one way to improve company growth is to somehow break that cycle. This would lead to more steps being taken on a weekly basis and more calories being burned, increasing overall user satisfaction and more products being used. 

Next we will gain insights from the average intensity of each user's activities throughout the day. Activities are rated from very active to inactive.


```{r avg_intensity, fig.height=10, fig.width=12, message=FALSE, warning=FALSE, max_height="720px"}

avg_intensity = daily_activity %>% group_by(Id) %>% 
  summarise_at(vars("VeryActiveMinutes", "FairlyActiveMinutes", "LightlyActiveMinutes", "SedentaryMinutes"), mean)
names(avg_intensity) = c("Id", "Very_Active", "Fairly_Active", "Lightly_Active", "Inactive")

## melting data to visualize
avg_intensity_long = melt(avg_intensity, id.vars=c("Id"))
ggplot(data = avg_intensity_long, aes(x=variable, y=value, fill=variable)) + 
  geom_bar(stat="identity") + facet_wrap(~Id) + 
  labs(title = "Average Activity Intensitiy per User", x = "Intensity", y = "Duration (minutes)") + 
  theme(axis.text.x = element_text(angle = 45)) + 
  scale_fill_manual(values = color_pallet)
  

```

It appears that each user has high rates of inactive activity, however we must remember that users are inactive while they are sleeping. We will replot our data without the inactive column to get a closer look at each user's average activity intensity. 

```{r avg_intensity2, echo=FALSE, fig.height=10, fig.width=12, message=FALSE, warning=FALSE, max_height="720px"}

avg_intensity_long2 = select(avg_intensity, -Inactive)
avg_intensity_long2 = melt(avg_intensity_long2, id.vars=c("Id"))
ggplot(data = avg_intensity_long2, aes(x=variable, y=value, fill=variable)) + 
  geom_bar(stat="identity") + facet_wrap(~Id) + 
  labs(title = "Average Activity Intensitiy per User", x = "Intensity", y = "Duration (minutes)") + 
  theme(axis.text.x = element_text(angle = 45)) + 
  scale_fill_manual(values = color_pallet)

```

When users are being active, they tend to stay in the "lightly active" category. It also appears that most users spend more time in the "very active" category versus the "fairly active" category. We can now plot the relationship between activity intensity and calories burned. 

```{r intensity_to_calories, fig.height=10, fig.width=12, message=FALSE, warning=FALSE, max_height="720px"}

## Very Active Intensity
ggplot(data = daily_activity) + geom_point(mapping = aes(x = VeryActiveMinutes, y = Calories)) + 
  geom_smooth(mapping = aes(x = VeryActiveMinutes, y = Calories)) + 
  facet_wrap(~Id) + 
  labs(title = "Calories burned by Very Active Intensity", x = "Duration of Activity (minutes)", y = "Calories Burned")

## Lightly Active Intensity
ggplot(data = daily_activity) + geom_point(mapping = aes(x = LightlyActiveMinutes, y = Calories)) + 
  geom_smooth(mapping = aes(x = LightlyActiveMinutes, y = Calories)) + 
  facet_wrap(~Id) + 
  labs(title = "Calories burned by Lightly Active Intensity", x = "Duration of Activity (minutes)", y = "Calories Burned")

```


As expected, typically the longer you stay active the more calories you burn. It appears to take considerably less time to burn more calories when being very active compared to being just lightly active. Knowing that users tend to stay more in the lightly active / inactive categories, Bellabeat's technology could motivate users to complete their calorie goal for the day quicker by promoting a quick exercise, increasing usage of several Bellabeat products.  

Next we will explore the relationship between total time in bed and calories burned for the day. Please note that half our users' sleep data was unavailable, so analysis may not be as accurate as the above analyses. 

```{r time_in_bed_to_calories, fig.height=10, fig.width=12, message=FALSE, warning=FALSE, max_height="720px"}

ggplot(data = daily_activity) + geom_point(mapping = aes(x = TotalTimeInBed, y = Calories)) + 
  geom_smooth(mapping = aes(x = TotalTimeInBed, y = Calories)) + 
  labs(title = "Relationship of Calories burned by Total Sleep Time", x = "Duration of Sleep (minutes)", y = "Calories Burned") 
  

```


There appears to be no relationship between sleep and calories burned throughout the day. We will now explore the correlation between average heart rate and calories burned for the day. Note that our available heart rate data is limited, so analysis may not be as accurate as above analyses. 

```{r heartrate_to_calories, fig.height=10, fig.width=12, message=FALSE, warning=FALSE, max_height="720px"}

ggscatter(daily_activity, x = "avg_heartrate", y = "Calories",
          add = "reg.line", conf.int = TRUE,
          add.params = list(color="blue", fill="lightgray"),
          cor.coef = TRUE, cor.method = "pearson",
          title = "Relationship of Calories Burned by Average Heart Rate",
          xlab = "Average Heart Rate (daily average)", 
          ylab = "Total Calories Burned")

```

Our data shows that average heart rate for a day and calories burned for that day are loosely correlated, but statistically insignificant.  


# Conclusion   

* Users tend to burn more calories the more steps they take. Bellabeat products, like the Leaf or Time, could excel in this area by connecting to the Bellabeat app and keep track of several metrics to showcase progress.  
* Smart device users tend to go from periods of lower activity to periods of higher activity, in a cycle. If the same trend exists for Bellabeat users, then breaking that cycle could potentially lead to more sales by achieving results quicker. By having the app downloaded, users could be reminded periodically about their progress and how they compared to the previous days.  
* Most users spend most of their time being inactive or only lightly active, and not much time being very active in comparison. Also, it takes much less time per day to burn more calories by being highly active versus being lightly active. By reminding users of their activity rate, it could motivate them to become more active, using Bellabeat devices more often. By being more active, you will also need to stay hydrated and keep up with the amount of water you intake. This could also lead to more sales for Bellabeat's Spring product. Also, this leads for opportunity for the Bellabeat membership program to step up and create a personalized routine for their users. 
* Better recording of data such as: sleep, weight, and heart rate, could lead to better insights in the future.   






